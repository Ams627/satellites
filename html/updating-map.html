<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<title>Satellite Tracker</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    #logic {
      padding: 1rem;
      background-color: #f0f0f0;
    }

    #map {
      width: 100%;
      height: 100px; /* temporary, will be set by JS */
    }
</style>

</style>
<body>
<div id="logic">
    <div id="checkboxList" style="max-height: 400px; overflow-y: scroll; border: 1px solid #ccc;"></div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>

function resizeMap() {
const logicHeight = document.getElementById('logic').offsetHeight;
const map = document.getElementById('map');
const windowHeight = window.innerHeight;
map.style.height = (windowHeight - logicHeight) + 'px';
}

window.addEventListener('resize', resizeMap);
window.addEventListener('load', () => {
resizeMap(); // set initial height

const map = L.map('map').setView([50.0, 14.0], 13);
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
const marker = L.circleMarker([50.0, 14.0], {radius: 8, color: 'red'}).addTo(map);

let current = {lat: 50.0, lon: 14.0};
let target = {lat: 50.0, lon: 14.0};
let lastUpdate = performance.now();

function updateLocation() {
  fetch('/location')
    .then(res => res.json())
    .then(data => {
      current = {...target}; // set current to previous target
      target = data;
      lastUpdate = performance.now();
    });
}

function animate() {
  const now = performance.now();
  const progress = Math.min(1, (now - lastUpdate) / 100); // 100ms interval
  const lat = current.lat + (target.lat - current.lat) * progress;
  const lon = current.lon + (target.lon - current.lon) * progress;
  marker.setLatLng([lat, lon]);
  requestAnimationFrame(animate);
}

setInterval(updateLocation, 100);
animate();

</script>


</body>
</html>